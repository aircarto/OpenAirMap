<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="https://aircarto.fr/images/favicon.ico" />

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <!-- AJAX -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <!-- Bootstrap 5.3.0 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <!-- my files -->
    <script src="js_scripts/NebuleAir.js"></script>
    <script src="js_scripts/purpleAir.js"></script>
    <script src="js_scripts/AtmoSudRef.js"></script>
    <script src="js_scripts/AtmoSudMicro.js"></script>
    <script src="js_scripts/sensorCommunity.js"></script>
    <!-- style CSS  -->
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/radar.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-hash/0.2.1/leaflet-hash.min.js"></script>

    <title>Open Air Map</title>
</head>

<body>
    <!-- LA CARTE -->
    <div id="map"></div>

    <!-- Toast de chargement des données -->
    <div class="toast-container position-fixed end-0 p-3" style="bottom:10px;">
        <div class="toast align-items-center" id="liveToast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    Chargement des données <span class="spinner-border spinner-border-sm" role="status"
                        aria-hidden="true"></span>
                </div>
                <!-- <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button> -->
            </div>
        </div>
    </div>

    <!-- Boutons PM1 PM2.5 PM10 -->
    <div class="btn-group" id="div_buttonPM" role="group">
        <button id="button_PM1" class="btn btn-outline-primary">PM1</button>  
        <button id="button_PM25" class="btn btn-primary">PM2.5</button>
        <button id="button_PM10" class="btn btn-outline-primary">PM10</button>
    </div>

    <!-- Bouton mon NebuleAir -->
    <div id="div_button_monNebuleAir"><a id="button_monNebuleAir" class="btn btn-primary" role="button" href="https://nebuleair.fr/monNebuleAir.php">Mon NebuleAir</a></div>

    <!-- Bouton dropdown Choix des capteurs -->
    <div class="dropdown" id="div_checkbox_choixCapteur">
        <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown"
            data-bs-auto-close="outside" aria-expanded="false">
            Choix des capteurs
        </button>
        <ul class="dropdown-menu">
            <li><input type="checkbox" id="checkbox_micro_stationsParticuliers"name="checkbox_micro_stationsParticuliers"/><label for="checkbox_micro_stationsParticuliers">Micro-stations NebuleAir particuliers</label></li>
            <li><input type="checkbox" id="checkbox_sensor_community" name="checkbox_sensor_community"/><label for="checkbox_sensor_community"></label>Capteurs Sensor.Community</label></li>
            <li><input type="checkbox" id="checkbox_stationsRefAtmoSud" name="checkbox_stationsRefAtmoSud"/><label for="checkbox_stationsRefAtmoSud">Stations de Référence AtmoSud</label></li>
            <li><input type="checkbox" id="checkbox_micro_stationsAtmoSud" name="checkbox_micro_stationsAtmoSud"/><label for="checkbox_micro_stationsAtmoSud">Micro-stations AtmoSud</label></li>
            <li><input type="checkbox" id="checkbox_modelisationAtmoSud" name="checkbox_modelisationAtmoSud" /><label for="checkbox_modelisationAtmoSud">Modélisation ICAIRh AtmoSud</label></li>
            <li><input type="checkbox" id="checkbox_purpleAir" name="checkbox_purpleAir" /><label for="checkbox_purpleAir">Capteurs PurpleAir</label></li>
        </ul>
    </div>


    <!-- Seuils PM -->
    <div class="btn-group" id="div_button_seuils_PM125" role="group">
        <button class="btn" id="btn_bon" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="0 à 10 &#181;g/m&#179;">Bon</button>
        <button class="btn" id="btn_moyen" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="11 à 20 &#181;g/m&#179;">Moyen</button>
        <button class="btn" id="btn_degrade" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="21 à 25 &#181;g/m&#179;">Dégradé</button>
        <button class="btn" id="btn_mauvais" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="26 à 50 &#181;g/m&#179;">Mauvais</button>
        <button class="btn" id="btn_tres_mauvais" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="51 à 75 &#181;g/m&#179;">Très Mauvais</button>
        <button class="btn" id="btn_extr_mauvais" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title=">75 &#181;g/m&#179;">Extr. Mauvais</button>
    </div>

    <div class="btn-group" id="div_button_seuils_PM10" role="group">
        <button class="btn" id="btn_bon" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="0 à 20 &#181;g/m&#179;">Bon</button>
        <button class="btn" id="btn_moyen" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="21 à 40 &#181;g/m&#179;">Moyen</button>
        <button class="btn" id="btn_degrade" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="41 à 50 &#181;g/m&#179;">Dégradé</button>
        <button class="btn" id="btn_mauvais" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="51 à 100 &#181;g/m&#179;">Mauvais</button>
        <button class="btn" id="btn_tres_mauvais" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title="101 à 150 &#181;g/m&#179;">Très Mauvais</button>
        <button class="btn" id="btn_extr_mauvais" data-bs-toggle="tooltip" data-bs-placement="bottom"
            data-bs-title=">150 &#181;g/m&#179;">Extr. Mauvais</button>
    </div>

    <!-- Boutons pas de temps -->
    <div class="btn-group" id="div_button_pas_de_temps" role="group">
        <button class="btn btn-primary" id="btn_actuel">Actuel</button>
        <button class="btn btn-outline-primary" id="btn_quartHoraire">Quart-horaire</button>
        <button class="btn btn-outline-primary" id="btn_horaire">Horaire</button>
        <button class="btn btn-outline-primary" id="btn_journalier">Journalier</button>
    </div>

    <button type="button" class="btn btn-outline-primary" id="button_horloge"></button>

    <script>
        var date = new Date();
        const hour = date.getHours();
        const min = date.getMinutes();
        document.getElementById("button_horloge").innerHTML = hour + ":" + (min < 10 ? '0' : '') + min;
    </script>

    <!-- Les Logos -->
    <!-- <div id="logoAirCarto"><a href="https://aircarto.fr/"><img src="img/logoAirCarto.png" alt=""></a></div> -->

    <!-- LE SIDE PANEL (id "sidePanel") -->
    <div class="row">
        <div class="col-5">
            <div class="card m-3" id="sidePanel" style="display: none;">
                <!-- Bouton pour fermer le panel -->
                <button type="button" class="btn-close position-absolute top-0 end-0" aria-label="Close"
                    style="margin: 5px ;" onclick="CloseSidePanel()"></button>
                <!-- <img src="img/Logo_Nebulo2.png" alt="" class="card-img-top"> -->

                <div class="card-body">
                    <!-- Nom du capteur en haut -->
                    <h3 id="title_deviceName"></h3>
                    <h5 class="card-title">Evolution des concentrations en particules fines (&#181;g/m<sup>3</sup>)</h5>

                    <!--  Grafana iframe -->
                    <iframe id="chartSensor" src="about:blank" width="100%" height="400" frameborder="0"></iframe>

                    <!-- <p class="card-text">
                        Some quick example text to build on the card title and make up the bulk of the
                        card's
                        content.
                    </p> -->
                    <span id="button1h"></span>
                    <span id="button3h"></span>
                    <span id="button24h"></span>
                    <span id="button48h"></span>
                    <span id="button1s"></span>
                    <span id="button1m"></span>


                </div>
            </div>
        </div>

    </div>

    <script>

        var compoundUpper = "PM25";
        var timespanLower = 2;

        let coordsCenter = [43.29490421, 5.37188392];
        let zoomLevel = 15;

        //on crée la carte, centrée sur Marseille
        var map = L.map('map', { zoomControl: false });

        //on y ajoute la couche OSM
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            maxZoom: 21
        }).addTo(map);

        new L.Hash(map);

        if (location.hash) {
            const hash_params = location.hash.split("/");
            coordsCenter = [hash_params[1], hash_params[2]];
            zoomLevel = hash_params[0].substring(1);
        }

        map.setView(coordsCenter, zoomLevel);

        var nebuleairParticuliers = new L.layerGroup();
        var sensorCommunity = new L.layerGroup();
        var stationsRefAtmoSud = new L.layerGroup();
        var stationsMicroAtmoSud = new L.layerGroup();

        // Switch case
        // reload


        document.querySelector("#checkbox_micro_stationsParticuliers").checked = true;
        document.querySelector("#checkbox_sensor_community").checked = false;
        document.querySelector("#checkbox_stationsRefAtmoSud").checked = false;
        document.querySelector("#checkbox_micro_stationsAtmoSud").checked = false;
        document.querySelector("#checkbox_modelisationAtmoSud").checked = false;
        document.querySelector("#checkbox_purpleAir").checked = false;

        if (document.querySelector("#checkbox_micro_stationsParticuliers").checked) { map.addLayer(nebuleairParticuliers) }
        if (document.querySelector("#checkbox_sensor_community").checked) { map.addLayer(sensorCommunity) }
        if (document.querySelector("#checkbox_stationsRefAtmoSud").checked) { map.addLayer(stationsRefAtmoSud) }
        if (document.querySelector("#checkbox_micro_stationsAtmoSud").checked) { map.addLayer(stationsMicroAtmoSud) }


        document.querySelector("#checkbox_micro_stationsParticuliers").addEventListener("change", switchNebuleAir)
        document.querySelector("#checkbox_sensor_community").addEventListener("change", switchSensorCommunity)
        document.querySelector("#checkbox_stationsRefAtmoSud").addEventListener("change", switchRefAtmo)
        document.querySelector("#checkbox_micro_stationsAtmoSud").addEventListener("change", switchMicroAtmo)

        function switchNebuleAir() {
            if (document.querySelector("#checkbox_micro_stationsParticuliers").checked) {
                if(apiFetchNebuleAir.data.length == 0 || (apiFetchNebuleAir.data.length != 0 && Date.now()-apiFetchNebuleAir.timestamp > timespanLower * 60 * 1000))
                {
                    console.log("Reload NebuleAir!");
                    loadNebuleAir();
                }
                    map.addLayer(nebuleairParticuliers);

            } else {
                map.removeLayer(nebuleairParticuliers);
            }
        }

        function switchSensorCommunity() {

            if(timespanLower != 15){
            if (document.querySelector("#checkbox_sensor_community").checked) {
                if(apiFetchSensorCommunity.data.length == 0 || (apiFetchSensorCommunity.data.length != 0 && Date.now()-apiFetchSensorCommunity.timestamp > timespanLower * 60 * 1000))
                {
                    console.log("Reload Sensor.Community!");
                    loadSensorCommunity();
                }
                map.addLayer(sensorCommunity);
            } else {
                map.removeLayer(sensorCommunity);
            }
        }else{
            alert("Pas de moyenne quart-horaire pour les capteurs Sensor.Community");
        }

        }

        function switchRefAtmo() {

        if(timespanLower != 2){
            if (document.querySelector("#checkbox_stationsRefAtmoSud").checked) { //ATTENTION CAS 2mins
                if(apiFetchAtmoSudRef.data.length == 0 || (apiFetchAtmoSudRef.data.length != 0 && Date.now()-apiFetchAtmoSudRef.timestamp > timespanLower * 60 * 1000))
                {
                    console.log("Reload AtmoSud Ref!");
                    loadStationRefAtmo();
                }
                map.addLayer(stationsRefAtmoSud);
            } else {
                map.removeLayer(stationsRefAtmoSud);
            }
        }else{
            alert("Pas de données à intervalle 2 minutes pour les stations de référence AtmoSud");
            document.querySelector("#checkbox_stationsRefAtmoSud").checked = false;

        }


        }

        function switchMicroAtmo() {
        
            if(timespanLower != 15 & timespanLower != 60 & timespanLower != 1440){
            if (document.querySelector("#checkbox_micro_stationsAtmoSud").checked) {
                if(apiFetchAtmoSudMicro.data.length == 0 || (apiFetchAtmoSudMicro.data.length != 0 && Date.now()-apiFetchAtmoSudMicro.timestamp > timespanLower * 60 * 1000))
                {
                    console.log("Reload AtmoSud Micro");
                    loadStationMicroAtmo();
                }
                map.addLayer(stationsMicroAtmoSud);
            } else {
                map.removeLayer(stationsMicroAtmoSud);
            }
        }else{
            alert("Pas de données à intervalles 15 minutes, 1 heure ou 1 jour pour les microstations AtmoSud");
        }
        }

        document.querySelector("#button_PM1").addEventListener("click", choosePM1)
        document.querySelector("#button_PM25").addEventListener("click", choosePM25)
        document.querySelector("#button_PM10").addEventListener("click", choosePM10)

        function choosePM1() {
            document.querySelector("#button_PM10").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#button_PM25").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#button_PM1").classList.replace("btn-outline-primary", "btn-primary");
            compoundUpper = "PM1";
            document.querySelector("#div_button_seuils_PM10").style.visibility = "hidden";
            document.querySelector("#div_button_seuils_PM125").style.visibility = "visible";

            if (document.querySelector("#checkbox_micro_stationsParticuliers").checked) {

                nebuleairParticuliers.clearLayers();
                changeNebuleAir();
            }

            if (document.querySelector("#checkbox_sensor_community").checked) {
            sensorCommunity.clearLayers();
            changeSensorCommunity();
            }

        }

        function choosePM25() {
            document.querySelector("#button_PM10").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#button_PM25").classList.replace("btn-outline-primary", "btn-primary");
            document.querySelector("#button_PM1").classList.replace("btn-primary", "btn-outline-primary");
            compoundUpper = "PM25";
            document.querySelector("#div_button_seuils_PM10").style.visibility = "hidden";
            document.querySelector("#div_button_seuils_PM125").style.visibility = "visible";
            
            if (document.querySelector("#checkbox_micro_stationsParticuliers").checked) {
            nebuleairParticuliers.clearLayers();
            changeNebuleAir();
            }

            if (document.querySelector("#checkbox_sensor_community").checked) {
            sensorCommunity.clearLayers();
            changeSensorCommunity();
            }
        }

        function choosePM10() {
            document.querySelector("#button_PM10").classList.replace("btn-outline-primary", "btn-primary");
            document.querySelector("#button_PM25").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#button_PM1").classList.replace("btn-primary", "btn-outline-primary");
            compoundUpper = "PM10";
            document.querySelector("#div_button_seuils_PM10").style.visibility = "visible";
            document.querySelector("#div_button_seuils_PM125").style.visibility = "hidden";

            if (document.querySelector("#checkbox_micro_stationsParticuliers").checked) {
            nebuleairParticuliers.clearLayers();
            changeNebuleAir();
            }


            if (document.querySelector("#checkbox_sensor_community").checked) {
            sensorCommunity.clearLayers();
            changeSensorCommunity();
            }
        }

        document.querySelector("#btn_actuel").addEventListener("click", chooseActuel)
        document.querySelector("#btn_quartHoraire").addEventListener("click", choose15)
        document.querySelector("#btn_horaire").addEventListener("click", choose60)
        document.querySelector("#btn_journalier").addEventListener("click", choose1440)

        function chooseActuel() {
            document.querySelector("#btn_journalier").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_horaire").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_quartHoraire").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_actuel").classList.replace("btn-outline-primary", "btn-primary");
            timespanLower = 2;
        }

        function choose15() {
            document.querySelector("#btn_journalier").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_horaire").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_quartHoraire").classList.replace("btn-outline-primary", "btn-primary");
            document.querySelector("#btn_actuel").classList.replace("btn-primary", "btn-outline-primary");
            timespanLower = 15;
        }

        function choose60() {
            document.querySelector("#btn_journalier").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_horaire").classList.replace("btn-outline-primary", "btn-primary");
            document.querySelector("#btn_quartHoraire").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_actuel").classList.replace("btn-primary", "btn-outline-primary");
            timespanLower = 60;
        }

        function choose1440() {
            document.querySelector("#btn_journalier").classList.replace("btn-outline-primary", "btn-primary");
            document.querySelector("#btn_horaire").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_quartHoraire").classList.replace("btn-primary", "btn-outline-primary");
            document.querySelector("#btn_actuel").classList.replace("btn-primary", "btn-outline-primary");
            timespanLower = 1440;
        }

        //ouverture du toast
        function openToast_loading() {
            const toastLiveExample = document.getElementById('liveToast')
            const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
            console.log("Showing loading toast");
            toastBootstrap.show()
        }
        //fermeture du toast
        function closeToast_loading() {
            const toastLiveExample = document.getElementById('liveToast')
            const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
            console.log("Hiding loading toast");
            toastBootstrap.hide()
        }


        // ************************
        //Très important: on start la fonction "loadNebuleAir" une première fois avec document.ready
        $(document).ready(loadNebuleAir);
        // $(document).ready(loadSensorCommunity);
        // $(document).ready(loadStationRefAtmo);
        // $(document).ready(loadStationMicroAtmo);
        $(document).ready(openToast_loading);

        // ************************


        //fonction qui ouvre le side panel
        function OpenSidePanel(sensor) {
            const targetDiv = document.getElementById("sidePanel");
            console.log(sensor);
            targetDiv.style.display = "block";
            document.getElementById("title_deviceName").innerHTML = sensor;

            if (sensor.includes("nebuleair"))
            {
                let id = sensor.split("-")[1];
                console.log(id);

            document.getElementById("chartSensor").src = "https://grafana.aircarto.fr/d-solo/Hcs4NEb4z/nebuleair?orgId=1&var-device=" + sensor + "&from=now-1h&to=now&theme=light&panelId=10";
            document.getElementById("button1h").innerHTML = '<button type="button" onclick="chooseTime(\'' + sensor + '\',1)" class="btn btn-secondary btn-sm">1h</button>';
            document.getElementById("button3h").innerHTML = '<button type="button" onclick="chooseTime(\'' + sensor + '\', 3)" class="btn btn-secondary btn-sm">3h</button>';
            document.getElementById("button24h").innerHTML = '<button type="button" onclick="chooseTime(\'' + sensor + '\', 24)" class="btn btn-secondary btn-sm">24h</button>';
            document.getElementById("button48h").innerHTML = '<button type="button" onclick="chooseTime(\'' + sensor + '\', 48)" class="btn btn-secondary btn-sm">48h</button>';
            document.getElementById("button1s").innerHTML = '<button type="button" onclick="chooseTime(\'' + sensor + '\', 168)" class="btn btn-secondary btn-sm">1 semaine</button>';
            document.getElementById("button1m").innerHTML = '<button type="button" onclick="chooseTime(\'' + sensor + '\', 720)" class="btn btn-secondary btn-sm">1 mois</button>';


            }

            if (sensor.includes("sensor.community"))
            {
                let id = sensor.split("-")[1];
                console.log(id);

                document.getElementById("chartSensor").src = "https://api-rrd.madavi.de:3000/grafana/d/000000004/single-sensor-view?orgId=1&var-node="+ id;

            }
        }

        //changer la couleur du bouton en fonction du choix (not working?)
        function chooseTime(sensor, hours) {
            document.getElementById("chartSensor").src = "https://grafana.aircarto.fr/d-solo/Hcs4NEb4z/nebulo?orgId=1&var-device=" + sensor + "&from=now-" + hours + "h&to=now&theme=light&panelId=10";
            if (hours == 24) {
                //Not working???
                document.getElementById("button24h").classList.replace("btn-outline-secondary", "btn-primary");
                console.log("test");
            }
        }


        //fonction qui ferme le side panel
        function CloseSidePanel() {
            const targetDiv = document.getElementById("sidePanel");
            targetDiv.style.display = "none";
        }


        var root1;
        var root2;
        var root3;



        setInterval(function () {
console.log("Setinterval:");
console.log(timespanLower * 60 * 1000);




        }, timespanLower * 60 * 1000)  

// ON ne fetch pas tout
var apiFetchNebuleAir = {"data":[], "timespan":null, "timestamp":null};
var apiFetchAtmoSudRef = {"data":[], "timespan":null, "timestamp":null};
var apiFetchAtmoSudMicro = {"data":[], "timespan":null, "timestamp":null};
var apiFetchSensorCommunity = {"data":[], "timespan":null, "timestamp":null};


// var lastFetchTimeNebuleAir,lastFetchTime,lastFetchTime,lastFetchTime,lastFetchTime;

// if (!lastFetchTimeTHP || now - lastFetchTime >= 5 * 60 * 1000) {

//     lastFetchTime = now;
// }else{



// }

async function retrieveDataReload() {

console.log("retrieveDataReload()");
console.log(compoundUpper);
console.log(timespanLower);

const now = new Date();

if (compoundUpper == "PM1"){

}

if (compoundUpper == "PM25"){

}

if (compoundUpper == "PM10"){

}

const date = new Date();
const dateParser = timeParse("%Y-%m-%d %H:%M:%S");
const getOffsetHours = date.getTimezoneOffset() * 60000;
const logTimestamp = dateParser(timestamp_data).getTime();
const lastUpdateTimestamp = logTimestamp + -getOffsetHours;  //COMPRENDS PAS!!!
const dateFormater = locale.format("%d.%m.%Y %H:%M");

}



    </script>

    <!-- Bootstrap 5.3.0 -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
        integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
        crossorigin="anonymous"></script>
    <script>
        var tooltipTriggerList = [].slice.call(
            document.querySelectorAll('[data-bs-toggle="tooltip"]')
        );
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>

</html>